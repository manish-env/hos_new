<div class="new-slider">
{% if section.settings.title != blank %}
  <h2 class="title inline-richtext h2 text-center bold">
      {{ section.settings.title }}
  </h2>
{% endif %}
<div id="{{ section.id }}-slideshow" class="new-slider flex">
  {% for block in section.blocks %}
    <div class="new-slider-slide">
      <div class="slide-card">
        {% if block.settings.url %}<a href="{{ block.settings.url }}">{% endif %}
        {% if block.settings.desktop_image %}{{ block.settings.desktop_image | image_url: width: 1900 | image_tag: class: 'img-responsive desktop-only' }}{% endif %}
        {% if block.settings.mobile_image %}{{ block.settings.mobile_image | image_url: width: 1900 | image_tag: class: 'img-responsive mobile-only' }}{% endif %}
        {% if block.settings.url %}</a>{% endif %}
        
        {% if block.settings.show_cta_button and block.settings.button_text != blank %}
          <div class="slide-cta-button-container" style="{% if section.settings.cta_position == 'bottom' %}position: absolute; bottom: {{ section.settings.cta_bottom_position }}px; {% endif %}{% if section.settings.cta_position == 'center' %}position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);{% endif %}{% if section.settings.cta_position == 'custom' %}position: absolute; top: {{ section.settings.cta_top_position }}px; left: {{ section.settings.cta_left_position }}px;{% endif %}">
            <a href="{{ block.settings.button_link | default: block.settings.url }}" class="slide-cta-button" style="background-color: {{ section.settings.button_bg_color }}; color: {{ section.settings.button_text_color }}; border-radius: {{ section.settings.button_border_radius }}px; padding: {{ section.settings.button_padding }}px;">
              {{ block.settings.button_text }}
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
</div>
<style>
   #{{ section.id }}-slideshow .new-slider-slide{
    width: calc(100%/{{ section.settings.col_desktop}});
    position: relative;
  }
  @media screen and (max-width: 767px){
    #{{ section.id }}-slideshow .new-slider-slide{
    width: calc(100%/{{ section.settings.col_mobile}});
    }
  }
  
  .slide-cta-button-container {
    z-index: 5;
    text-align: center;
    width: 100%;
  }
  
  .slide-cta-button {
    display: inline-block;
    text-decoration: none;
    font-weight: bold;
    min-width: 120px;
    text-align: center;
    transition: all 0.3s ease;
  }
  
  .slide-cta-button:hover {
    opacity: 0.85;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {

    var carousel = document.querySelector('#{{ section.id }}-slideshow');
    carousel.style.display = 'block';
    var flkty = new Flickity(carousel, {
        // options
        wrapAround: {{ section.settings.wrap_around | default: true }},
        contain: true,
        pageDots: {{ section.settings.show_dots | default: false }},
        prevNextButtons: {{ section.settings.show_arrow | default: false }},
        autoPlay: {{ section.settings.autoplay | default: true }},
        on: {
          ready: function () {
            this.element.classList.remove("flex");
            this.resize();
          },
        }
    });
});
</script>
{% schema %}
  {
    "name": "New Slider",
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Title"
      },
      {
        "type": "range",
        "id": "col_desktop",
        "min": 1,
        "max": 6,
        "step": 1,
        "unit": "col",
        "label": "Desktop Columns",
        "default": 1
      },
      {
        "type": "range",
        "id": "col_mobile",
        "min": 1,
        "max": 3,
        "step": 1,
        "unit": "col",
        "label": "Mobile Columns",
        "default": 1
      },
      {
        "type": "checkbox",
        "id": "show_arrow",
        "label": "Show arrows",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "show_dots",
        "label": "Show dots",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "wrap_around",
        "label": "Wrap Around",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "autoplay",
        "label": "Autoplay",
        "default": true
      },
      {
        "type": "header",
        "content": "CTA Button Settings"
      },
      {
        "type": "color",
        "id": "button_bg_color",
        "label": "Button Background Color",
        "default": "#000000"
      },
      {
        "type": "color",
        "id": "button_text_color",
        "label": "Button Text Color",
        "default": "#ffffff"
      },
      {
        "type": "range",
        "id": "button_border_radius",
        "min": 0,
        "max": 50,
        "step": 1,
        "unit": "px",
        "label": "Button Border Radius",
        "default": 4
      },
      {
        "type": "range",
        "id": "button_padding",
        "min": 5,
        "max": 30,
        "step": 1,
        "unit": "px",
        "label": "Button Padding",
        "default": 10
      },
      {
        "type": "select",
        "id": "cta_position",
        "label": "CTA Button Position",
        "options": [
          {
            "value": "bottom",
            "label": "Bottom"
          },
          {
            "value": "center",
            "label": "Center"
          },
          {
            "value": "custom",
            "label": "Custom Position"
          }
        ],
        "default": "bottom"
      },
      {
        "type": "range",
        "id": "cta_bottom_position",
        "min": 10,
        "max": 100,
        "step": 5,
        "unit": "px",
        "label": "Bottom Position (if Bottom selected)",
        "default": 20
      },
      {
        "type": "range",
        "id": "cta_top_position",
        "min": 10,
        "max": 500,
        "step": 5,
        "unit": "px",
        "label": "Top Position (if Custom selected)",
        "default": 200
      },
      {
        "type": "range",
        "id": "cta_left_position",
        "min": 10,
        "max": 500,
        "step": 5,
        "unit": "px",
        "label": "Left Position (if Custom selected)",
        "default": 200
      }
    ],
    "blocks": [
      {
        "type": "slide",
        "name": "Slide",
        "settings": [
          {
            "type": "image_picker",
            "id": "desktop_image",
            "label": "Desktop Image"
          },
          {
            "type": "image_picker",
            "id": "mobile_image",
            "label": "Mobile Image"
          },
          {
            "type": "url",
            "id": "url",
            "label": "Slide Link"
          },
          {
            "type": "header",
            "content": "CTA Button"
          },
          {
            "type": "checkbox",
            "id": "show_cta_button",
            "label": "Show CTA Button",
            "default": false
          },
          {
            "type": "text",
            "id": "button_text",
            "label": "Button Text"
          },
          {
            "type": "url",
            "id": "button_link",
            "label": "Button Link (if different from Slide Link)"
          },
          {
            "type": "header",
            "content": "Columns"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "New Slider"
      }
    ]
  }
{% endschema %}