{%- assign ldmx_id = section.id -%}
<section class="ldmx-wrap" data-ldmx="{{ ldmx_id }}">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* scope everything to this section */
    [data-ldmx="{{ ldmx_id }}"]{
      --ldmx-accent: {{ section.settings.accent_color }};
      --ldmx-text:#222; --ldmx-muted:#666; --ldmx-maxw: {{ section.settings.container_width | default: 1300 }}px;
    }
    [data-ldmx="{{ ldmx_id }}"] .ldmx-container{max-width:var(--ldmx-maxw); margin:0 auto; padding:0 16px;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-grid{display:grid; grid-template-columns: 1fr 1.2fr; gap:40px; align-items:center;}
    @media(max-width:992px){ [data-ldmx="{{ ldmx_id }}"] .ldmx-grid{grid-template-columns:1fr; gap:22px;} }

    /* Banner (left) */
    [data-ldmx="{{ ldmx_id }}"] .ldmx-banner{border-radius:14px; overflow:hidden; position:relative;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-banner img{width:100%; height:auto; display:block; object-fit:cover;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-cap{position:absolute; left:12px; bottom:12px; background:rgba(255,255,255,.92); padding:8px 12px; border-radius:10px; font-size:13px; color:var(--ldmx-text);}

    /* Heading: Great Vibes */
    [data-ldmx="{{ ldmx_id }}"] .ldmx-heading{
      font-family:"Great Vibes", cursive; font-weight:400; color:var(--ldmx-text);
      font-size: clamp(28px, 3.4vw, 42px); text-align:left; margin:0 0 14px;
    }

    /* Review block with FULL quotes */
    [data-ldmx="{{ ldmx_id }}"] .ldmx-review-wrap{
      position:relative; padding: 24px 36px 20px; /* breathable, no card */
    }
    /* open/close quotes covering whole review area */
    [data-ldmx="{{ ldmx_id }}"] .ldmx-review-wrap:before,
    [data-ldmx="{{ ldmx_id }}"] .ldmx-review-wrap:after{
      position:absolute; z-index:0; color:var(--ldmx-accent); opacity:.9; line-height:1;
      font-family: Georgia, serif; font-weight:700; pointer-events:none;
    }
    [data-ldmx="{{ ldmx_id }}"] .ldmx-review-wrap:before{
      content:"“"; left:0; top:-6px; font-size:84px; transform:translate(-8px,0);
    }
    [data-ldmx="{{ ldmx_id }}"] .ldmx-review-wrap:after{
      content:"”"; right:0; bottom:-12px; font-size:84px; transform:translate(8px,0);
    }

    /* Review content (no card) */
    [data-ldmx="{{ ldmx_id }}"] .ldmx-review{
      position:relative; z-index:1; text-align:center; max-width:780px; margin:0 auto;
    }
    [data-ldmx="{{ ldmx_id }}"] .ldmx-text{font-size:16px; line-height:1.8; color:var(--ldmx-text); margin-bottom:14px;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-stars{color:#21a956; letter-spacing:1px; font-size:18px; margin:6px 0 8px;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-author{margin-top:4px; font-weight:700; color:#8a2be2;} /* violet like screenshot */
    [data-ldmx="{{ ldmx_id }}"] .ldmx-meta{font-size:13px; color:var(--ldmx-muted); font-style:italic;}

    /* Carousel */
    [data-ldmx="{{ ldmx_id }}"] .ldmx-carousel{position:relative; overflow:hidden;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-track{display:flex; transition:transform .4s ease;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-slide{min-width:100%;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-nav{position:absolute; inset:0; pointer-events:none;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-btn{
      pointer-events:auto; position:absolute; top:50%; transform:translateY(-50%);
      width:42px; height:42px; border-radius:999px; background:transparent; border:none;
    }
    [data-ldmx="{{ ldmx_id }}"] .ldmx-btn i{font-size:22px; color:#9b9b9b;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-prev{left:6px;}
    [data-ldmx="{{ ldmx_id }}"] .ldmx-next{right:6px;}

  </style>

  <div class="ldmx-container">
    <div class="ldmx-grid">
      <!-- LEFT: Banner -->
      <div class="ldmx-left">
        {% if section.settings.banner != blank %}
          {% assign _link = section.settings.banner_link %}
          {% if _link != blank %}<a href="{{ _link }}" class="ldmx-banner">{% endif %}
            <div class="ldmx-banner">
              <img
                srcset="
                  {{ section.settings.banner | image_url: width: 480 }} 480w,
                  {{ section.settings.banner | image_url: width: 800 }} 800w,
                  {{ section.settings.banner | image_url: width: 1200 }} 1200w
                "
                sizes="(max-width: 992px) 100vw, 44vw"
                src="{{ section.settings.banner | image_url: width: 1200 }}"
                alt="{{ section.settings.banner_alt | escape }}">
              {% if section.settings.banner_caption != blank %}
                <div class="ldmx-cap">{{ section.settings.banner_caption }}</div>
              {% endif %}
            </div>
          {% if _link != blank %}</a>{% endif %}
        {% else %}
          <div class="ldmx-banner" style="aspect-ratio:4/3; display:grid; place-items:center; background:#f6f6f6;">
            <div style="color:#aaa; font-size:14px;">Add a banner image in settings</div>
          </div>
        {% endif %}
      </div>

      <!-- RIGHT: Reviews (title + full-quote block) -->
      <div class="ldmx-right">
        <h2 class="ldmx-heading">{{ section.settings.heading }}</h2>

        <div class="ldmx-review-wrap">
          <div class="ldmx-carousel" id="ldmx-cr-{{ ldmx_id }}">
            <div class="ldmx-track">
              {% for block in section.blocks %}
              {% if block.type == 'review' %}
              <div class="ldmx-slide">
                <div class="ldmx-review">
                  <div class="ldmx-text">{{ block.settings.text }}</div>
                  {% if section.settings.show_stars %}
                    <div class="ldmx-stars">
                      {% assign s = block.settings.stars | default: 5 %}
                      {% for i in (1..s) %}<i class="fa-solid fa-star"></i>{% endfor %}
                    </div>
                  {% endif %}
                  <div class="ldmx-author">{{ block.settings.author }}</div>
                  <div class="ldmx-meta">
                    {% if block.settings.location %}{{ block.settings.location }}{% endif %}
                    {% if block.settings.date %} · {{ block.settings.date }}{% endif %}
                  </div>
                </div>
              </div>
              {% endif %}
              {% endfor %}
            </div>

            {% if section.blocks.size > 1 %}
            <div class="ldmx-nav">
              <button class="ldmx-btn ldmx-prev" type="button" aria-label="Previous"><i class="fa-solid fa-chevron-left"></i></button>
              <button class="ldmx-btn ldmx-next" type="button" aria-label="Next"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const root = document.querySelector('[data-ldmx="{{ ldmx_id }}"]');
      if(!root) return;
      const car = root.querySelector('#ldmx-cr-{{ ldmx_id }}');
      if(!car) return;
      const track = car.querySelector('.ldmx-track');
      const slides = car.querySelectorAll('.ldmx-slide');
      const prev = car.querySelector('.ldmx-prev');
      const next = car.querySelector('.ldmx-next');
      let idx = 0;
      function go(n){ idx = (n + slides.length) % slides.length; track.style.transform = 'translateX(' + (-idx*100) + '%)'; }
      if(prev && next){ prev.addEventListener('click', ()=>go(idx-1)); next.addEventListener('click', ()=>go(idx+1)); }
      {% if section.settings.auto_rotate %} setInterval(()=>go(idx+1), {{ section.settings.rotate_ms | default: 5000 }}); {% endif %}
    })();
  </script>
</section>

{% schema %}
{
  "name": "LDMX – Reviews",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading (Great Vibes)", "default": "Customer Reviews" },
    { "type": "color", "id": "accent_color", "label": "Accent (quotes)", "default": "#ff4aa2" },
    { "type": "checkbox", "id": "show_stars", "label": "Show star ratings", "default": true },
    { "type": "range", "id": "container_width", "min": 1000, "max": 1600, "step": 20, "unit": "px", "label": "Max container width", "default": 1300 },

    { "type": "header", "content": "Left Banner" },
    { "type": "image_picker", "id": "banner", "label": "Banner image" },
    { "type": "text", "id": "banner_alt", "label": "Banner alt text", "default": "Promotional banner" },
    { "type": "text", "id": "banner_caption", "label": "Optional caption" },
    { "type": "url", "id": "banner_link", "label": "Optional link" },

    { "type": "header", "content": "Auto-rotate" },
    { "type": "checkbox", "id": "auto_rotate", "label": "Auto-rotate reviews", "default": false },
    { "type": "number", "id": "rotate_ms", "label": "Rotate interval (ms)", "default": 5000 }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        { "type": "richtext", "id": "text", "label": "Review text", "default": "<p>I just wanted to take a moment to sincerely thank Like A Diva for the effort and due diligence. The outfit is absolutely beautiful, and I’m really impressed with the quality.</p>" },
        { "type": "range", "id": "stars", "min": 1, "max": 5, "step": 1, "label": "Stars", "default": 5 },
        { "type": "text", "id": "author", "label": "Author", "default": "Bernice" },
        { "type": "text", "id": "location", "label": "Location", "default": "London, United Kingdom" },
        { "type": "text", "id": "date", "label": "Date (optional)" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [{ "name": "LDMX – Reviews", "blocks": [{ "type": "review" }] }]
}
{% endschema %}
