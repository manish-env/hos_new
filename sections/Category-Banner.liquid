{% comment %}
  Category Banner â€” per-collection banner with optional fallback
  Add this section to your collection template and map images per collection.
{% endcomment %}

{% if template.name == 'collection' %}
  {%- liquid
    assign matched_block = nil
    for b in section.blocks
      if b.type == 'banner' and b.settings.collection and collection and b.settings.collection.id == collection.id
        assign matched_block = b
        break
      endif
    endfor
  -%}

  {%- assign desktop_image = section.settings.fallback_image -%}
  {%- assign mobile_image = blank -%}
  {%- assign alt_text = collection.title -%}

  {%- if matched_block -%}
    {%- if matched_block.settings.desktop_image != blank -%}
      {%- assign desktop_image = matched_block.settings.desktop_image -%}
    {%- endif -%}
    {%- if matched_block.settings.mobile_image != blank -%}
      {%- assign mobile_image = matched_block.settings.mobile_image -%}
    {%- endif -%}
    {%- if matched_block.settings.alt != blank -%}
      {%- assign alt_text = matched_block.settings.alt -%}
    {%- endif -%}
  {%- endif -%}

  {% if desktop_image %}
    <div class="cat-banner {% if section.settings.full_width %}cat-banner--full{% else %}cat-banner--page{% endif %}" style="--h: {{ section.settings.banner_height }}px;">
      <picture>
        {% if mobile_image %}
          <source media="(max-width: 749px)" srcset="{{ mobile_image | image_url: width: 900 }}">
        {% endif %}
        <img
          class="cat-banner__img"
          src="{{ desktop_image | image_url: width: 2000 }}"
          alt="{{ alt_text | escape }}"
          loading="eager">
      </picture>
    </div>
  {% endif %}
{% endif %}

<style>
  .cat-banner { position: relative; margin: 0 auto; }
  .cat-banner--page { max-width: var(--page-width, 1200px); padding: 0 16px; }
  .cat-banner--full { width: 100%; }
  .cat-banner__img {
    display: block;
    width: 100%;
    height: var(--h);
    object-fit: cover;
    object-position: center;
    border-radius: {{ section.settings.radius }}px;
  }
</style>

{% schema %}
{
  "name": "Category Banner",
  "templates": ["collection"],
  "settings": [
    { "type": "checkbox", "id": "full_width", "label": "Full width", "default": true },
    { "type": "range", "id": "banner_height", "label": "Banner height (px)", "min": 160, "max": 700, "step": 10, "default": 380 },
    { "type": "range", "id": "radius", "label": "Corner radius (px)", "min": 0, "max": 24, "step": 2, "default": 0 },
    { "type": "image_picker", "id": "fallback_image", "label": "Fallback image (used if no match)" }
  ],
  "blocks": [
    {
      "type": "banner",
      "name": "Collection mapping",
      "settings": [
        { "type": "collection", "id": "collection", "label": "Collection to match" },
        { "type": "image_picker", "id": "desktop_image", "label": "Desktop image" },
        { "type": "image_picker", "id": "mobile_image", "label": "Mobile image (optional)" },
        { "type": "text", "id": "alt", "label": "Alt text (optional)" }
      ]
    }
  ],
  "presets": [{ "name": "Category Banner" }]
}
{% endschema %}
